\documentclass[11pt,a4j]{jsarticle}

\usepackage{float,array,booktabs,here}
\usepackage{amsmath}
\usepackage[dvipdfmx]{graphicx}
\usepackage[top=20truemm,bottom=25truemm,left=20truemm,right=20truemm]{geometry}
\usepackage{url}

\makeatletter
\newcommand{\figcaption}[1]{\def\@captype{figure}\caption{#1}}
\newcommand{\tblcaption}[1]{\def\@captype{table}\caption{#1}}
\makeatother

\newcommand{\Maru}[1]{\ooalign{
\ifnum#1<10 \hfil\resizebox{.9\width}{.85\height}{#1}\hfil
\else
\hfil\resizebox{.6\width}{.8\height}{#1}\hfil
\fi
\crcr
\raise.1ex\hbox{$\bigcirc$}}}

%\usepackage[tableposition=top]{caption}



\begin{document}

% \title{フィルター}
% \author{hogehoge}
% \date{2015年5月9日}
% \maketitle


\section{目的}
射影行列の意味を理解し、それを用いて3次元形状を2次元に描画する。
また反対に多視点の画像から射影行列を推測し立体形状を復元する実験から
立体形状を得るために必要な理論を理解する


\section{理論}
\label{sec:理論}

% \subsection{ディジタル画像}
% \label{sub:ディジタル画像}
% ピクセルは画像の要素を指す
% ディジタル画像では、1つだけの最も小さい点のことであり、画素は位置と色の二つのプロパティを持つ。
% 画素の位置の原点はいつも左方にあるが、垂直方向は最初の画素に依存し位置の範囲は画質により決定される。
% 色は RGB 色空間が用いられ、Red、Green、Blueの3つの構成要素があり、
% R、G、B それぞれの要素で 8bit ずつの情報を持つ。

\subsection{カメラについて}
\label{sub:カメラについて}
カメラとはピンホールカメラの原理で3D空間を2次元平面に写像するものである。
しかしながら現実には、ピンホールのような無限に小さい穴に
写像するのに十分な光を通すことは不可能であるのでレンズが利用される。


\subsection{射影行列}
\label{sub:射影行列}
射影行列とは、画像面位置と空間位置の関係を表す。世界座標系Mから画像座標系をmへの
射影行列Pを考えると式\ref{syaei}が成立する。このとき\~m、\~Mを式\ref{m}、式\ref{M}としており、Pは3×4行列である。

\begin{align}
  s\mathrm{\tilde{m}} &= \mathrm{P\tilde{M}} \label{syaei} \\[0.3cm]
  \mathrm{\tilde{m}} &= \left[
    \begin{array}{c}
      u \\ v \\ 1
    \end{array}
  \right] \label{m} \\[0.3cm]
  \mathrm{\tilde{M}} &= \left[
    \begin{array}{c}
      X \\ Y \\ Z \\ 1
    \end{array}
  \right] \label{M}
\end{align}



\subsection{カメラキャリブレーション}
\label{sub:カメラキャリブレーション}

3次元座標で既知のマーカ(X,Y,Z)と、その2次元座標での座標(u, v)がわかっていれば、
もともとの射影行列を推定することが可能である。
式\ref{syaei}、式\ref{m}、式\ref{M}より、
u, v を式 (4)、式 (5) のように表すことができる。

\begin{align}
  u = \frac{P_{11}X + P_{12}Y + P_{13}Z + P_{14}}{P_{31}X + P_{32}Y + P_{33}Z + P_{34}}
  \label{u} \\[0.3cm]
  v = \frac{P_{21}X + P_{22}Y + P_{23}Z + P_{24}}{P_{31}X + P_{32}Y + P_{33}Z + P_{34}}
  \label{v}
\end{align}

これを変形すると以下のようになる。

\begin{align}
  P_{11}X + P_{12}Y + P_{13}Z + P_{14} - P_{31}Xu - P_{32}Yu - P_{33}Zu = P_{34}u
  \label{u2} \\
  P_{21}X + P_{22}Y + P_{23}Z + P_{24} - P_{31}Xv - P_{32}Yv - P_{33}Zv = P_{34}v
  \label{v2}
\end{align}

ここて$゙P_{34}$を1として考え、行列として式\ref{u2}、式\ref{v2}を表すと式\ref{camera}のようになる。

\begin{align}
  \left[
    \begin{array}{ccccccccccc}
      X & Y & Z & 1 & 0 & 0 & 0 & 0 & -Xu & -Yu & -Zu \\
      0 & 0 & 0 & 0 & X & Y & Z & 1 & -Xv & -Yv & -Zv \\
    \end{array}
  \right]
  \left[
    \begin{array}{c}
      P_{11} \\ P_{12} \\ P_{13} \\ P_{14} \\
      P_{21} \\ P_{22} \\ P_{23} \\ P_{24} \\
      P_{31} \\ P_{32} \\ P_{33}
    \end{array}
  \right]
  =
  \left[
    \begin{array}{c}
      u \\ v
    \end{array}
  \right]
  \label{camera}
\end{align}

\subsection{ステレオ}
\label{sub:ステレオ}
ステレオは複数の画像により3次元検出することである。
人間などにおいて左目と右目からではものが見える位置に違いがあり、またこの違いのことを両眼視差と呼ぶ。
そしてステレオでは両眼視差を用いて3次元検出を行う。

式\ref{syaei}を次の式\ref{stereo}のように変形する。
\begin{align}
  argB
  \left[
    \begin{array}{c}
      X \\ Y \\ Z
    \end{array}
  \right]
  = argQ
  \label{stereo}
\end{align}

このとき式\ref{u}、式\ref{v}をX,Y,Zについてまとめると以下のようになる。

\begin{align}
  (P_{11} - P_{31}u)X + (P_{12} - P_{32}u)Y + (P_{13} - P_{33}u)Z = P_{34}u - P_{14}
  \label{u3} \\
  (P_{21} - P_{31}v)X + (P_{22} - P_{32}v)Y + (P_{23} - P_{33}v)Z = P_{34}v - P_{24}
  \label{v3}
\end{align}

よってargB,argQは次のようになる。

\begin{align}
  \mathrm{argB} =
  \left[
    \begin{array}{ccc}
      P_{11} - P_{31}u & P_{12} - P_{32}u & P_{13} - P_{33}u \\
      P_{21} - P_{31}v & P_{22} - P_{32}v & P_{23} - P_{33}v
    \end{array}
  \right]
  \label{argB} \\[0.5cm]
  \mathrm{argQ} =
  \left[
    \begin{array}{c}
      P_{34}u - P_{14} \\
      P_{34}v - P_{24}
    \end{array}
  \right]
  \label{argB}
\end{align}

\section{実験方法}
\label{sec:実験方法}

\subsection{サンプル画像への立方体の描写}
\label{sub:サンプル画像への立方体の描写}
式\ref{syaei}、式\ref{m}、式\ref{M}を用い、指定された画像と
その画像の射影行列と3次元座標 (X,Y,Z) から立方体の各点の2次元座標をもとめて、描画した。

\subsection{画像の射影行列の推測}
\label{sub:画像の射影行列の推測}
2枚の画像について、選んだそれぞれの点の 2 次元座標と式\ref{camera}を用いて、
2枚の画像のそれぞれの射影行列を推測した。

\subsection{多視点画像からの立体形状の復元}
\label{sub:多視点画像からの立体形状の復元}
\ref{sub:画像の射影行列の推測}節で推定した射影行列を用い、２枚の画像から同じ点をクリックして選び、
2枚の画像について式\ref{stereo}を用いて2次元座標から3次元座標(X, Y, Z)を求め、これをCGに描画した。


\subsection{立体形状からアナグリフの作成}
\label{sub:立体形状からアナグリフの作成}

\ref{sub:多視点画像からの立体形状の復元}節で復元した多視点画像からの立体形状を用い、
右目の画像として、Rを除いた、BとGの情報のみを含む画像を作成し、また左目の画像としてRのみを含む画像を
作成して、アナグリフ画像を作り、立体視できることを確認した。

\section{結果}
\label{sec:結果}

\subsection{サンプル画像への立方体の描写}
\label{sub:result_box}

正しく描画できている。結果は図\ref{fig:サンプル画像への立方体の描写の写真}である。

\begin{figure}[H]
  \centering
  \includegraphics[height=60mm,bb=0 0 640 480]{image/task0.jpg}
  \figcaption{サンプル画像への立方体の描写}
  \label{fig:サンプル画像への立方体の描写の写真}
\end{figure}


\subsection{画像の射影行列の推測}
\label{sub:result_syaei}

\subsection{多視点画像からの立体形状の復元}
\label{sub:result_multimage}

\subsection{立体形状からアナグリフの作成}
\label{sub:result_anaglyph}

\section{考察}
\label{sec:考察}

\subsection{画像から推測した射影行列の誤差}
\label{sub:画像から推測した射影行列の誤差}






\begin{thebibliography}{9} %ケタ数(９：一桁、９９：二桁)
\bibitem{saito} 斎藤英雄 , ``画像からの立体形状キャプチャ'' , 2016
\end{thebibliography}

\end{document}
